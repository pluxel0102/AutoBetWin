<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="AutoBet.Views.ROIConfigWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="60"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="80"/>
        </Grid.RowDefinitions>

        <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ–∫–Ω–∞ -->
        <Grid Grid.Row="0"
              Height="40"
              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
              BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
              BorderThickness="0,0,0,1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- –û–±–ª–∞—Å—Ç—å –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è -->
            <Grid x:Name="AppTitleBar" 
                  Grid.Column="0"
                  Grid.ColumnSpan="2"
                  Background="Transparent">
                
                <!-- –ò–∫–æ–Ω–∫–∞ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–∫–Ω–∞ -->
                <StackPanel Orientation="Horizontal" 
                           Spacing="8" 
                           Margin="16,0,0,0"
                           VerticalAlignment="Center">
                    <FontIcon Glyph="&#xE7B8;" 
                             FontSize="16"
                             Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                    <TextBlock Text="–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–ª–∞—Å—Ç–µ–π —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è" 
                              FontSize="13"
                              FontWeight="SemiBold"
                              Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                              VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>

            <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è -->
            <Button x:Name="CloseButton"
                    Grid.Column="2"
                    Click="CloseButton_Click"
                    Content="&#xE711;"
                    Width="46"
                    Height="32"
                    Margin="0,0,4,0"
                    Background="Transparent"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    BorderThickness="0"
                    FontFamily="Segoe MDL2 Assets"
                    FontSize="10"
                    CornerRadius="4">
                <Button.Resources>
                    <ResourceDictionary>
                        <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="#10FFFFFF"/>
                        <SolidColorBrush x:Key="ButtonBackgroundPressed" Color="#20FFFFFF"/>
                    </ResourceDictionary>
                </Button.Resources>
            </Button>
        </Grid>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ -->
        <Grid Grid.Row="1" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel VerticalAlignment="Center" Margin="32,0,0,0">
                <TextBlock 
                    Text="üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–ª–∞—Å—Ç–µ–π —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è MelBet" 
                    FontSize="20" 
                    FontWeight="SemiBold"
                    x:Name="TitleText"/>
                <TextBlock 
                    Text="–ù–∞—Å—Ç—Ä–æ–π—Ç–µ 16 –æ–±–ª–∞—Å—Ç–µ–π: –∫—É–±–∏–∫–∏, –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞–≤–æ–∫ (10-20000), X2, '–ù–µ –¥—É–±–ª—å', —Å–∫—Ä–æ–ª–ª" 
                    FontSize="12" 
                    Opacity="0.7"
                    Margin="0,4,0,0"
                    x:Name="SubtitleText"/>
            </StackPanel>

            <StackPanel 
                Grid.Column="1" 
                Orientation="Horizontal" 
                Spacing="12" 
                Margin="0,0,32,0"
                VerticalAlignment="Center">
                
                <Button 
                    x:Name="CaptureScreenButton"
                    Content="üì∏ –ó–∞—Ö–≤–∞—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω"
                    Style="{StaticResource AccentButtonStyle}"
                    Height="40"
                    Padding="20,0"
                    CornerRadius="20"
                    Click="CaptureScreenButton_Click">
                    <Button.Shadow>
                        <ThemeShadow/>
                    </Button.Shadow>
                    <Button.Translation>0,0,8</Button.Translation>
                </Button>

                <Button 
                    x:Name="LoadTemplateButton"
                    Height="40"
                    Padding="20,0"
                    CornerRadius="20"
                    Click="LoadTemplateButton_Click">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE8B7;" FontSize="16"/>
                        <TextBlock Text="–ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω"/>
                    </StackPanel>
                </Button>
                
                <Button 
                    x:Name="DeleteRegionsButton"
                    Height="40"
                    Padding="20,0"
                    CornerRadius="20"
                    Background="#F44336"
                    Click="DeleteRegionsButton_Click">
                    <Button.Resources>
                        <ResourceDictionary>
                            <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="#E53935"/>
                            <SolidColorBrush x:Key="ButtonBackgroundPressed" Color="#C62828"/>
                        </ResourceDictionary>
                    </Button.Resources>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE74D;" FontSize="16" Foreground="White"/>
                        <TextBlock Text="–£–¥–∞–ª–∏—Ç—å –æ–±–ª–∞—Å—Ç–∏" Foreground="White"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <Grid Grid.Row="2" Margin="32,24,32,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="360"/>
            </Grid.ColumnDefinitions>

            <!-- –û–±–ª–∞—Å—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
            <Grid 
                Background="{ThemeResource LayerFillColorDefaultBrush}" 
                CornerRadius="16"
                Padding="24"
                x:Name="PreviewPanel"
                Opacity="0"
                Scale="0.95,0.95,1">
                <Grid.Shadow>
                    <ThemeShadow/>
                </Grid.Shadow>
                <Grid.Translation>0,0,16</Grid.Translation>
                <Grid.OpacityTransition>
                    <ScalarTransition Duration="0:0:0.4"/>
                </Grid.OpacityTransition>
                <Grid.ScaleTransition>
                    <Vector3Transition Duration="0:0:0.4"/>
                </Grid.ScaleTransition>

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- –ë–æ–ª—å—à–∞—è –ø–∞–Ω–µ–ª—å —Å —Ç–µ–∫—É—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π -->
                <Border 
                    Grid.Row="0"
                    Background="{ThemeResource AccentFillColorDefaultBrush}"
                    CornerRadius="12"
                    Padding="24,16"
                    Margin="0,0,0,16"
                    x:Name="CurrentInstructionPanel"
                    Visibility="Collapsed">
                    <Border.OpacityTransition>
                        <ScalarTransition Duration="0:0:0.3"/>
                    </Border.OpacityTransition>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <FontIcon 
                            Grid.Column="0"
                            FontFamily="Segoe MDL2 Assets" 
                            Glyph="&#xE946;" 
                            FontSize="32"
                            Foreground="White"
                            VerticalAlignment="Center"
                            Margin="0,0,16,0"/>
                        
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock 
                                x:Name="CurrentStepText"
                                Text="–®–∞–≥ 1 –∏–∑ 16"
                                FontSize="13"
                                FontWeight="SemiBold"
                                Foreground="White"
                                Opacity="0.9"
                                Margin="0,0,0,4"/>
                            <TextBlock 
                                x:Name="CurrentInstructionText"
                                Text="–í—ã–¥–µ–ª–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å –ª–µ–≤–æ–≥–æ –∫—É–±–∏–∫–∞"
                                FontSize="18"
                                FontWeight="Bold"
                                Foreground="White"
                                TextWrapping="Wrap"/>
                        </StackPanel>
                        
                        <TextBlock 
                            Grid.Column="2"
                            x:Name="CurrentInstructionIcon"
                            Text="üé≤"
                            FontSize="48"
                            VerticalAlignment="Center"
                            Margin="16,0,0,0"/>
                    </Grid>
                </Border>

                <!-- Placeholder -->
                <StackPanel 
                    Grid.Row="1"
                    x:Name="PlaceholderPanel"
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Center"
                    Spacing="16">
                    <FontIcon 
                        FontFamily="Segoe MDL2 Assets" 
                        Glyph="&#xE91B;" 
                        FontSize="64"
                        Opacity="0.3"/>
                    <TextBlock 
                        Text="–ù–∞–∂–º–∏—Ç–µ 'üì∏ –ó–∞—Ö–≤–∞—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω' –¥–ª—è –Ω–∞—á–∞–ª–∞" 
                        FontSize="16"
                        Opacity="0.5"
                        TextAlignment="Center"/>
                    <TextBlock 
                        Text="–ó–∞—Ç–µ–º –≤—ã–¥–µ–ª–∏—Ç–µ 16 –æ–±–ª–∞—Å—Ç–µ–π –º—ã—à—å—é" 
                        FontSize="13"
                        Opacity="0.4"
                        TextAlignment="Center"/>
                </StackPanel>

                <!-- ScrollViewer –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ -->
                <ScrollViewer 
                    Grid.Row="1" 
                    x:Name="ScreenshotScrollViewer"
                    Visibility="Collapsed"
                    HorizontalScrollBarVisibility="Auto"
                    VerticalScrollBarVisibility="Auto"
                    ZoomMode="Enabled"
                    MinZoomFactor="0.1"
                    MaxZoomFactor="2">
                    
                    <!-- Canvas –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è ROI -->
                    <Canvas 
                        x:Name="ROICanvas"
                        PointerPressed="ROICanvas_PointerPressed"
                        PointerMoved="ROICanvas_PointerMoved"
                        PointerReleased="ROICanvas_PointerReleased">
                        
                        <Image 
                            x:Name="ScreenshotImage"
                            Stretch="None"/>
                    </Canvas>
                </ScrollViewer>
            </Grid>

            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <Grid Grid.Column="1" Margin="24,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <Grid 
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    CornerRadius="16"
                    Padding="20"
                    x:Name="StatsPanel"
                    Opacity="0"
                    Scale="0.95,0.95,1">
                    <Grid.Shadow>
                        <ThemeShadow/>
                    </Grid.Shadow>
                    <Grid.Translation>0,0,16</Grid.Translation>
                    <Grid.OpacityTransition>
                        <ScalarTransition Duration="0:0:0.4"/>
                    </Grid.OpacityTransition>
                    <Grid.ScaleTransition>
                        <Vector3Transition Duration="0:0:0.4"/>
                    </Grid.ScaleTransition>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock 
                        Text="üìä –ü—Ä–æ–≥—Ä–µ—Å—Å" 
                        FontSize="16" 
                        FontWeight="SemiBold"
                        Margin="0,0,0,16"/>

                    <StackPanel Grid.Row="1" Spacing="12">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="–û–±–ª–∞—Å—Ç–∏ –≤—ã–¥–µ–ª–µ–Ω–æ:" Opacity="0.7"/>
                            <TextBlock 
                                Grid.Column="1" 
                                x:Name="ROICountText"
                                Text="0 / 16" 
                                FontWeight="SemiBold"
                                Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                        </Grid>

                        <ProgressBar 
                            x:Name="ROIProgressBar"
                            Maximum="16" 
                            Value="0"
                            Height="8"
                            CornerRadius="4"/>
                    </StackPanel>
                </Grid>

                <!-- –°–ø–∏—Å–æ–∫ –æ–±–ª–∞—Å—Ç–µ–π -->
                <Grid 
                    Grid.Row="1" 
                    Margin="0,16,0,0"
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    CornerRadius="16"
                    Padding="20"
                    x:Name="ListPanel"
                    Opacity="0"
                    Scale="0.95,0.95,1">
                    <Grid.Shadow>
                        <ThemeShadow/>
                    </Grid.Shadow>
                    <Grid.Translation>0,0,16</Grid.Translation>
                    <Grid.OpacityTransition>
                        <ScalarTransition Duration="0:0:0.4"/>
                    </Grid.OpacityTransition>
                    <Grid.ScaleTransition>
                        <Vector3Transition Duration="0:0:0.4"/>
                    </Grid.ScaleTransition>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock 
                        Text="üìù –û–±–ª–∞—Å—Ç–∏" 
                        FontSize="16" 
                        FontWeight="SemiBold"
                        Margin="0,0,0,16"/>

                    <ScrollViewer Grid.Row="1">
                        <ItemsRepeater x:Name="ROIListRepeater" Margin="0,0,0,12">
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate>
                                    <Grid 
                                        Margin="0,0,0,8"
                                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                        CornerRadius="12"
                                        Padding="16,12"
                                        PointerEntered="ROIItem_PointerEntered"
                                        PointerExited="ROIItem_PointerExited">
                                        <Grid.OpacityTransition>
                                            <ScalarTransition Duration="0:0:0.2"/>
                                        </Grid.OpacityTransition>

                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <Border 
                                            Width="8" 
                                            Height="8" 
                                            CornerRadius="4"
                                            Background="{ThemeResource AccentFillColorDefaultBrush}"
                                            VerticalAlignment="Center"
                                            Margin="0,0,12,0"/>

                                        <StackPanel Grid.Column="1" Spacing="4">
                                            <TextBlock 
                                                Text="{Binding Name}" 
                                                FontSize="13"
                                                FontWeight="SemiBold"/>
                                            <TextBlock 
                                                FontSize="11"
                                                Opacity="0.6">
                                                <Run Text="{Binding X}"/>
                                                <Run Text="√ó"/>
                                                <Run Text="{Binding Y}"/>
                                                <Run Text="¬∑"/>
                                                <Run Text="{Binding Width}"/>
                                                <Run Text="√ó"/>
                                                <Run Text="{Binding Height}"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <Button 
                                            Grid.Column="2"
                                            Background="Transparent"
                                            BorderBrush="Transparent"
                                            Padding="8"
                                            Width="32"
                                            Height="32">
                                            <FontIcon 
                                                FontFamily="Segoe MDL2 Assets" 
                                                Glyph="&#xE74D;" 
                                                FontSize="12"/>
                                        </Button>
                                    </Grid>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </ScrollViewer>
                </Grid>

                <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
                <Grid 
                    Grid.Row="2" 
                    Margin="0,16,0,0"
                    Background="{ThemeResource AccentFillColorDefaultBrush}"
                    CornerRadius="16"
                    Padding="20"
                    x:Name="InfoPanel"
                    Opacity="0"
                    Scale="0.95,0.95,1">
                    <Grid.Shadow>
                        <ThemeShadow/>
                    </Grid.Shadow>
                    <Grid.Translation>0,0,16</Grid.Translation>
                    <Grid.OpacityTransition>
                        <ScalarTransition Duration="0:0:0.4"/>
                    </Grid.OpacityTransition>
                    <Grid.ScaleTransition>
                        <Vector3Transition Duration="0:0:0.4"/>
                    </Grid.ScaleTransition>

                    <StackPanel Spacing="8">
                        <TextBlock 
                            Text="üí° –ü–æ—Ä—è–¥–æ–∫ –æ–±–ª–∞—Å—Ç–µ–π MelBet:" 
                            FontSize="13"
                            FontWeight="SemiBold"
                            Foreground="White"/>
                        <TextBlock 
                            TextWrapping="Wrap"
                            FontSize="12"
                            Foreground="White"
                            Opacity="0.9"
                            LineHeight="20">
                            1: –û–±–ª–∞—Å—Ç—å –∫—É–±–∏–∫–æ–≤ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç)<LineBreak/>
                            2-3: –°–∏–Ω—è—è/–ö—Ä–∞—Å–Ω–∞—è (—Ü–≤–µ—Ç —Å—Ç–∞–≤–∫–∏)<LineBreak/>
                            4-12: –°—Ç–∞–≤–∫–∏ 10-20000 (9 –∫–Ω–æ–ø–æ–∫)<LineBreak/>
                            13: X2 (—É–¥–≤–æ–µ–Ω–∏–µ)<LineBreak/>
                            14: "–ù–µ –¥—É–±–ª—å" (200k)<LineBreak/>
                            15-16: –°–∫—Ä–æ–ª–ª –≤–ø—Ä–∞–≤–æ/–≤–ª–µ–≤–æ
                        </TextBlock>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <Grid 
            Grid.Row="3" 
            Background="{ThemeResource LayerFillColorDefaultBrush}"
            Padding="32,0"
            x:Name="BottomPanel"
            Opacity="0"
            Translation="0,20,0">
            <Grid.OpacityTransition>
                <ScalarTransition Duration="0:0:0.4"/>
            </Grid.OpacityTransition>
            <Grid.TranslationTransition>
                <Vector3Transition Duration="0:0:0.4"/>
            </Grid.TranslationTransition>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button 
                x:Name="ResetButton"
                Height="40"
                Padding="24,0"
                CornerRadius="20"
                Click="ResetButton_Click">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon FontFamily="Segoe MDL2 Assets" Glyph="&#xE894;" FontSize="16"/>
                    <TextBlock Text="–°–±—Ä–æ—Å–∏—Ç—å"/>
                </StackPanel>
            </Button>

            <StackPanel 
                Grid.Column="2" 
                Orientation="Horizontal" 
                Spacing="12">
                
                <Button 
                    x:Name="CancelButton"
                    Content="–û—Ç–º–µ–Ω–∞"
                    Height="40"
                    Padding="32,0"
                    CornerRadius="20"
                    Click="CancelButton_Click"/>

                <Button 
                    x:Name="SaveButton"
                    Content="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
                    Height="40"
                    Padding="32,0"
                    CornerRadius="20"
                    IsEnabled="False"
                    Click="SaveButton_Click"
                    Background="#10B981"
                    Foreground="White"
                    BorderBrush="#10B981">
                    <Button.Shadow>
                        <ThemeShadow/>
                    </Button.Shadow>
                    <Button.Translation>0,0,8</Button.Translation>
                    <Button.Resources>
                        <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="#0D9668"/>
                        <SolidColorBrush x:Key="ButtonBackgroundPressed" Color="#0A7C56"/>
                        <SolidColorBrush x:Key="ButtonBackgroundDisabled" Color="#6B7280"/>
                    </Button.Resources>
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
